<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Cropper</title>
    <style>
        /* Your CSS styles here */
    </style>
</head>
<body>
    <input type="file" id="uploadInput" accept="image/*" multiple>
    <button onclick="cropImages()">Crop Images</button>
    <div id="outputContainer"></div>

    <script>
        function cropImages() {
            const input = document.getElementById('uploadInput');
            const outputContainer = document.getElementById('outputContainer');

            const promises = Array.from(input.files).map((file, index) => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.src = URL.createObjectURL(file);

                    img.onload = function () {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const blackThreshold = 30;

                        // Find cropping dimensions
                        let leftMostNonBlack = img.width;
                        let rightMostNonBlack = 0;

                        ctx.drawImage(img, 0, 0);
                        const imageData = ctx.getImageData(0, 0, img.width, img.height);
                        const data = imageData.data;

                        for (let x = 0; x < img.width; x++) {
                            for (let y = 0; y < img.height; y++) {
                                const index = (y * img.width + x) * 4;
                                const red = data[index];
                                const green = data[index + 1];
                                const blue = data[index + 2];

                                // Check if the pixel is not black
                                if (!(red < blackThreshold && green < blackThreshold && blue < blackThreshold)) {
                                    leftMostNonBlack = Math.min(leftMostNonBlack, x);
                                    rightMostNonBlack = Math.max(rightMostNonBlack, x);
                                }
                            }
                        }

                        // Crop image
                        const croppedWidth = rightMostNonBlack - leftMostNonBlack;
                        canvas.width = croppedWidth;
                        canvas.height = img.height;
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, leftMostNonBlack, 0, croppedWidth, img.height, 0, 0, croppedWidth, img.height);

                        // Create download link
                        const downloadLink = document.createElement('a');
                        downloadLink.href = canvas.toDataURL();
                        downloadLink.download = `cropped_image_${index + 1}.png`;
                        downloadLink.innerText = `Download Image ${index + 1}`;

                        // Append download link to container
                        outputContainer.appendChild(downloadLink);

                        resolve();
                    };
                });
            });

            // Ensure images are downloaded in order
            promises.reduce((prevPromise, currentPromise) => {
                return prevPromise.then(() => currentPromise);
            }, Promise.resolve());
        }
    </script>
</body>
</html>
